# 3、6、7模块设计

## 3 流程与业务逻辑模块

![所在层次图](层次框架图（模块3）.drawio.png)

- 主要目的：允许用户设计、执行和管理业务流程、规则和决策逻辑，以提高业务的自动化和效率。
- 设计思路：将Activiti用于流程管理和工作流程，Drools用于业务规则管理，实现高度可定制的业务逻辑。
  - Activiti用于创建、部署和执行工作流程，包括任务分配、审批和状态跟踪。
  - Drools用于定义和管理业务规则，如决策表、规则集等，以根据不同情况执行自动化决策。
- 业务设计：
  - 流程设计： 用户使用图形化设计器来设计业务流程，包括定义任务、连线、审批等。用户新建流程->用户使用拖拽、配置等设计业务流程->系统储存流程信息。
  - 规则定义： 用户使用可视化界面定义业务规则、条件和操作。用户新建规则->用户通过填表、编程等设计业务规则->系统储存规则信息。
  - 部署： 用户将设计的流程和规则部署至目标项目中。用户选择部署至某一项目中->系统返回项目数据模型->用户配置数据流、规则等->系统储存部署信息。
  - 调试和监视： 用户可以启动流程实例，监视正在执行的流程，查看任务状态，同时进行审批任务，最后返回执行结果。用户进入调试模式->用户填写实例->用户启动运行->系统根据项目的流程与规则运行->（系统等待用户审批->用户审批）->系统返回执行结果。
- 向下接口或数据需要：
  1. 流程与规则数据库：用于存储流程和规则定义。
- 向上接口提供：
  1. 工作流程管理接口，包括流程设计、执行、管理与监控。
  2. 业务规则管理接口，包括规则定义、执行、管理与监控（其中包含预设的公共函数库）。
  3. 数据集成接口，包括实例数据的输入、执行结果数据的输出。
  4. 通知接口： 在设计或调试时向发送通知、提醒和警报。

## 6 扩展模块管理

![所在层次图](层次框架图（模块6）.drawio.png)

- 主要目的：为 SaaS 平台用户提供一种强大且可靠的方式来引入、管理和维护自定义或第三方模块，以增强本平台的功能和可定制性。
- 设计思路：模仿并利用 Java 9+ 的 Jigsaw 模块系统和 Maven 的依赖管理来实现一个模块化的扩展模块管理系统。Jigsaw 技术用于代码封装和版本管理。Maven 用于管理项目依赖和构建项目。
- 业务设计：
  - 模块上传： 允许用户上传自定义模块或选择第三方模块，如：自定义的插件、主题，第三方的地图、工具等。用户填写模块描述文件->上传模块->系统检查模块合法性->记录日志->若合法，储存模块。
  - 模块依赖管理： 用户能够指定模块之间的依赖关系。用户填写依赖信息->系统检查依赖关系是否正确->记录日志->若正确，储存模块依赖关系。
  - 版本管理与更新： 用户可查看模块的版本信息，并选择升级到最新版本或回滚到任意历史版本。用户查看模块版本信息->系统提供历史的版本信息->用户选择修改到某一版本->系统修改目标模块的版本。
  - 模块启用和停用： 用户能够启用或停用已安装的模块，用于测试新模块或在不需要时禁用旧模块。用户启用或禁用目标模块->系统标记目标模块的启用或禁用状态。
  - 模块状态检查： 提供模块的状态检查功能，且在出错时提供相应的反馈。
  - 日志和通知： 记录模块的安装、更新、启用、停用以及其他重要操作；向管理员或用户发送通知。
- 向下接口或数据需要：
  1. 模块描述文件： 每个模块应该有一个描述文件，其中包含模块的元数据，如名称、版本、作者、依赖关系等信息。
  2. 模块存储数据库： 存储已上传的模块文件，包括历史版本。
  3. 模块依赖关系数据库： 存储模块之间的依赖关系。
  4. 日志数据库： 存储操作日志和模块状态信息。
- 向上接口提供：
  1. 模块上传接口（ModuleUpload）： 允许用户上传模块文件。
  2. 模块管理接口（ModuleManager）： 提供操作模块的API，如安装、更新、启用、停用、卸载等。
  3. 模块查询接口（ModuleQuery）： 允许用户查询可用模块、检查模块状态和版本信息。
  4. 模块通知接口（ModuleNotification）： 用于向管理员或用户发送通知。
  5. 模块检查接口（ModuleCheck）： 用于检查模块的状态和健康情况。
  6. 模块日志查询接口（ModuleLogQuery）： 允许用户查看操作日志和模块状态信息。

## 7 发布与管理模块

![所在层次图](层次框架图（模块7）.drawio.png)

- 主要目的：允许用户对应用程序进行打包、发布、升级，并监控应用程序的性能和稳定性。包括自动构建、持续集成、版本控制、性能监控和备份。
- 设计思路：基于Jenkins技术，使用持续集成和持续交付（CI/CD）原则来实现应用程序的自动构建、部署和管理。
  - 使用Jenkins作为构建和部署工具，允许用户配置自动化的构建任务和部署管道。
  - 使用版本控制系统管理应用程序，进行版本控制和历史记录。
  - 集成性能监控工具，实时监控应用程序的性能。
- 业务设计：
  - 配置构建任务： 用户配置Jenkins构建任务，指定如何构建应用程序。代码更改后，Jenkins自动触发构建任务，检索源代码，执行构建，生成应用程序的可执行文件或包。
  - 配置部署： 用户配置部署管道，定义应用程序的运行环境和目标服务器。代码更改后，Jenkins自动触发部署任务，将应用程序部署到目标服务器。
  - 性能监控： 系统使用性能监控工具，实时监控应用程序的性能指标。
  - 版本控制： 系统使用Git等记录应用程序的版本，进行备份和版本控制，并记录日志。
  - 日志和通知： 记录每次自动构建、部署操作；向管理员或用户发送性能监控通知。
- 向下接口或数据需要：
  1. 源代码数据库，从界⾯设计、数据模型、业务逻辑等处获得源代码。

- 向上接口提供：
  1. 应用构建接口（AppBuild）、应用部署接口（AppDeployment）、应用性能监控接口（AppPerformanceMonitoring）等
